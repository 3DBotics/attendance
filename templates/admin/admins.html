{% extends 'admin/base_admin.html' %}

{% block title %}Admin Management - 3DBotics Admin{% endblock %}

{% block admin_content %}
<div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-teal-800">Admin Management</h1>
    <button onclick="document.getElementById('addAdminModal').classList.remove('hidden')" 
            class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700">
        <i class="fas fa-plus mr-2"></i>Add Admin
    </button>
</div>

<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
    <h3 class="font-bold text-yellow-800 mb-2"><i class="fas fa-info-circle mr-2"></i>About Admin Roles</h3>
    <ul class="text-sm text-yellow-700 space-y-1">
        <li><strong>Master Admin:</strong> Full access - can add/edit/delete employees, records, branches, admins, and reset database</li>
        <li><strong>Sub Admin:</strong> View-only access - can monitor attendance, view payroll, and compute salaries but cannot make changes</li>
    </ul>
</div>

<div class="bg-white rounded-xl shadow overflow-hidden">
    <table class="w-full">
        <thead class="bg-teal-50">
            <tr>
                <th class="px-6 py-4 text-left text-teal-800">Username</th>
                <th class="px-6 py-4 text-left text-teal-800">Full Name</th>
                <th class="px-6 py-4 text-left text-teal-800">Role</th>
                <th class="px-6 py-4 text-left text-teal-800">Status</th>
                <th class="px-6 py-4 text-left text-teal-800">Created</th>
                <th class="px-6 py-4 text-center text-teal-800">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for admin in admins %}
            <tr class="border-t hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">{{ admin.username }}</td>
                <td class="px-6 py-4">{{ admin.full_name }}</td>
                <td class="px-6 py-4">
                    {% if admin.role == 'master_admin' %}
                    <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">
                        <i class="fas fa-crown mr-1"></i>Master Admin
                    </span>
                    {% else %}
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                        <i class="fas fa-user mr-1"></i>Sub Admin
                    </span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if admin.is_active %}
                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Active</span>
                    {% else %}
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm">Inactive</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">{{ admin.created_at[:10] if admin.created_at else 'N/A' }}</td>
                <td class="px-6 py-4 text-center">
                    <button onclick="editAdmin({{ admin.id }}, '{{ admin.full_name }}', '{{ admin.role }}', {{ admin.is_active }})" 
                            class="text-teal-600 hover:text-teal-800 mr-4">
                        <i class="fas fa-edit"></i>
                    </button>
                    {% if admin.role != 'master_admin' %}
                    <button onclick="confirmDeleteAdmin({{ admin.id }}, '{{ admin.username }}')" 
                            class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="addAdminModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-teal-800 mb-6">Add New Admin</h2>
        <form method="POST" action="/admin/admins/add">
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Username</label>
                    <input type="text" name="username" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Full Name</label>
                    <input type="text" name="full_name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Password</label>
                    <input type="password" name="password" required minlength="6" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Role</label>
                    <select name="role" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        <option value="sub_admin">Sub Admin (View Only)</option>
                        <option value="master_admin">Master Admin (Full Access)</option>
                    </select>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-4">
                <button type="button" onclick="document.getElementById('addAdminModal').classList.add('hidden')" 
                        class="px-6 py-2 border rounded-lg hover:bg-gray-100">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Add Admin</button>
            </div>
        </form>
    </div>
</div>

<div id="editAdminModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-teal-800 mb-6">Edit Admin</h2>
        <form method="POST" id="editAdminForm">
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Full Name</label>
                    <input type="text" name="full_name" id="editFullName" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">New Password (leave blank to keep)</label>
                    <input type="password" name="new_password" minlength="6" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-1">Role</label>
                    <select name="role" id="editRole" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        <option value="sub_admin">Sub Admin (View Only)</option>
                        <option value="master_admin">Master Admin (Full Access)</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" name="is_active" id="editIsActive" class="mr-2">
                    <label class="text-gray-700">Active</label>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-4">
                <button type="button" onclick="document.getElementById('editAdminModal').classList.add('hidden')" 
                        class="px-6 py-2 border rounded-lg hover:bg-gray-100">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<div id="deleteAdminModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-red-600 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i>Delete Admin</h2>
        <p class="text-gray-700 mb-4">Are you sure you want to delete admin "<span id="deleteAdminName" class="font-bold"></span>"?</p>
        <form method="POST" id="deleteAdminForm">
            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-1">Enter your password to confirm</label>
                <input type="password" name="password" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">
            </div>
            <div class="flex justify-end space-x-4">
                <button type="button" onclick="document.getElementById('deleteAdminModal').classList.add('hidden')" 
                        class="px-6 py-2 border rounded-lg hover:bg-gray-100">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Delete</button>
            </div>
        </form>
    </div>
</div>

<script>
function editAdmin(id, fullName, role, isActive) {
    document.getElementById('editAdminForm').action = '/admin/admins/' + id + '/update';
    document.getElementById('editFullName').value = fullName;
    document.getElementById('editRole').value = role;
    document.getElementById('editIsActive').checked = isActive == 1;
    document.getElementById('editAdminModal').classList.remove('hidden');
}

function confirmDeleteAdmin(id, username) {
    document.getElementById('deleteAdminForm').action = '/admin/admins/' + id + '/delete';
    document.getElementById('deleteAdminName').textContent = username;
    document.getElementById('deleteAdminModal').classList.remove('hidden');
}
</script>
{% endblock %}
