{% extends 'admin/base_admin.html' %}

{% block title %}Employees - 3DBotics Admin{% endblock %}

{% block admin_content %}
<div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-teal-800">Employees</h1>
    <button onclick="document.getElementById('addEmployeeModal').classList.remove('hidden')" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700">
        <i class="fas fa-plus mr-2"></i>Add Employee
    </button>
</div>

<div class="bg-white rounded-xl shadow overflow-hidden">
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Branch</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Daily Rate</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {% for emp in employees %}
            <tr class="{% if emp.status and emp.status != 'active' %}bg-gray-50{% elif emp.is_resigned %}bg-gray-50{% endif %}">
                <td class="px-6 py-4 text-sm text-gray-900">{{ emp.employee_id }}</td>
                <td class="px-6 py-4 text-sm text-gray-900">
                    <div class="flex items-center">
                        {% if emp.id_photo %}
                        <img src="{{ emp.id_photo if emp.id_photo.startswith('data:') else '/' + emp.id_photo }}" class="w-8 h-8 rounded-full mr-2 object-cover">
                        {% else %}
                        <div class="w-8 h-8 rounded-full bg-gray-300 mr-2 flex items-center justify-center">
                            <i class="fas fa-user text-gray-500 text-xs"></i>
                        </div>
                        {% endif %}
                        {{ emp.first_name }} {{ emp.last_name }}
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">{{ emp.position or 'N/A' }}</td>
                <td class="px-6 py-4 text-sm text-gray-500">{{ emp.branch_name or 'N/A' }}</td>
                <td class="px-6 py-4 text-sm text-gray-900">₱{{ "%.2f"|format(emp.daily_rate) }}</td>
                <td class="px-6 py-4">
                    {% set status = emp.status or ('resigned' if emp.is_resigned else 'active') %}
                    <span class="px-2 py-1 text-xs rounded-full 
                        {% if status == 'active' %}bg-teal-100 text-teal-700
                        {% elif status == 'resigned' %}bg-yellow-100 text-yellow-700
                        {% elif status == 'terminated' %}bg-red-100 text-red-700
                        {% else %}bg-gray-100 text-gray-700{% endif %}">
                        {{ status|title }}
                    </span>
                </td>
                <td class="px-6 py-4 text-sm space-x-2">
                    <button onclick="viewEmployee({{ emp.id }})" class="text-blue-600 hover:text-blue-800" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button onclick="editEmployee({{ emp.id }})" class="text-teal-600 hover:text-teal-800" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    {% set current_status = emp.status or ('resigned' if emp.is_resigned else 'active') %}
                    {% if current_status == 'active' and can_edit_delete %}
                    <button onclick="openStatusChange({{ emp.id }}, '{{ emp.first_name }} {{ emp.last_name }}')" class="text-coral-300 hover:text-coral-500" title="Change Status">
                        <i class="fas fa-user-times"></i>
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-6 py-8 text-center text-gray-500">No employees found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Add Employee Modal -->
<div id="addEmployeeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto py-4">
    <div class="bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
            <h2 class="text-xl font-bold text-teal-800">Add New Employee</h2>
            <button type="button" onclick="closeModal('addEmployeeModal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <form action="/admin/employees/add" method="POST" enctype="multipart/form-data">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h3 class="font-semibold text-teal-700 border-b pb-2">Basic Information</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Employee ID *</label>
                            <input type="text" name="employee_id" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Position</label>
                            <input type="text" name="position" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">First Name *</label>
                            <input type="text" name="first_name" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Last Name *</label>
                            <input type="text" name="last_name" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
                            <input type="date" name="date_of_birth" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Gender</label>
                            <select name="gender" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Civil Status</label>
                            <select name="civil_status" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                                <option value="">Select</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                                <option value="widowed">Widowed</option>
                                <option value="separated">Separated</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Address</label>
                        <textarea name="address" rows="2" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Phone</label>
                            <input type="tel" name="phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" name="email" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Employment Details</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Branch *</label>
                        <select name="branch_id" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                            {% for branch in branches %}
                            <option value="{{ branch.id }}">{{ branch.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Daily Rate (₱) *</label>
                            <input type="number" name="daily_rate" step="0.01" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date Hired</label>
                            <input type="date" name="date_hired" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Weekly Schedule</h3>
                    <p class="text-sm text-gray-600 mb-4">Configure working days and hours for each day of the week. Uncheck days that are rest days.</p>
                    
                    <!-- Sunday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="sunday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Sunday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 sunday-times" style="display: none;">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="sunday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="sunday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Monday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="monday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Monday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 monday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="monday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="monday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tuesday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="tuesday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Tuesday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 tuesday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="tuesday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="tuesday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wednesday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="wednesday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Wednesday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 wednesday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="wednesday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="wednesday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thursday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="thursday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Thursday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 thursday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="thursday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="thursday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Friday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="friday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Friday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 friday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="friday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="friday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Saturday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="saturday_is_working" checked class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Saturday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 saturday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="saturday_start_time" value="08:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="saturday_end_time" value="17:00" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700">Schedule Effective From</label>
                        <input type="date" name="schedule_effective_from" value="{{ today }}" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        <p class="text-xs text-gray-500 mt-1">This schedule will be effective from this date onwards</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">PIN (4 digits) *</label>
                        <input type="password" name="pin" required pattern="\d{4}" maxlength="4" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="Enter 4-digit PIN">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="font-semibold text-teal-700 border-b pb-2">ID Photo & Documents</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID Photo</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div id="addCameraPlaceholder" class="text-center py-8">
                                <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-500">Take a photo for ID</p>
                                <button type="button" onclick="startCamera('add')" class="mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                                    Start Camera
                                </button>
                            </div>
                            <video id="addCameraPreview" class="hidden w-full rounded-lg" autoplay playsinline></video>
                            <img id="addCapturedPhoto" class="hidden w-full rounded-lg">
                            <input type="hidden" name="id_photo" id="addIdPhotoData">
                            <div class="mt-4 flex justify-center space-x-2">
                                <button type="button" id="addCaptureBtn" onclick="capturePhoto('add')" class="hidden px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">
                                    Capture Photo
                                </button>
                                <button type="button" id="addRetakeBtn" onclick="retakePhoto('add')" class="hidden px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    Retake
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">CV/Resume (PDF)</label>
                        <input type="file" name="cv_file" accept=".pdf" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Government IDs</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">SSS Number</label>
                            <input type="text" name="sss_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">PhilHealth Number</label>
                            <input type="text" name="philhealth_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Pag-IBIG Number</label>
                            <input type="text" name="pagibig_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">TIN</label>
                            <input type="text" name="tin_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Emergency Contact</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Contact Name</label>
                        <input type="text" name="emergency_contact_name" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Contact Phone</label>
                            <input type="tel" name="emergency_contact_phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Relationship</label>
                            <input type="text" name="emergency_contact_relationship" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="e.g., Spouse, Parent">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Reference Person</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Reference Name</label>
                        <input type="text" name="reference_name" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Reference Phone</label>
                            <input type="tel" name="reference_phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Company/Organization</label>
                            <input type="text" name="reference_company" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3 border-t pt-4">
                <button type="button" onclick="closeModal('addEmployeeModal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Add Employee</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Employee Modal -->
<div id="editEmployeeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto py-4">
    <div class="bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
            <h2 class="text-xl font-bold text-teal-800">Edit Employee</h2>
            <button type="button" onclick="closeModal('editEmployeeModal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <form id="editEmployeeForm" method="POST" enctype="multipart/form-data">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h3 class="font-semibold text-teal-700 border-b pb-2">Basic Information</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Employee ID *</label>
                            <input type="text" name="employee_id" id="edit_employee_id" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Position</label>
                            <input type="text" name="position" id="edit_position" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">First Name *</label>
                            <input type="text" name="first_name" id="edit_first_name" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Last Name *</label>
                            <input type="text" name="last_name" id="edit_last_name" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
                            <input type="date" name="date_of_birth" id="edit_date_of_birth" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Gender</label>
                            <select name="gender" id="edit_gender" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Civil Status</label>
                            <select name="civil_status" id="edit_civil_status" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                                <option value="">Select</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                                <option value="widowed">Widowed</option>
                                <option value="separated">Separated</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Address</label>
                        <textarea name="address" id="edit_address" rows="2" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Phone</label>
                            <input type="tel" name="phone" id="edit_phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" name="email" id="edit_email" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Employment Details</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Branch *</label>
                        <select name="branch_id" id="edit_branch_id" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                            {% for branch in branches %}
                            <option value="{{ branch.id }}">{{ branch.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Daily Rate (₱) *</label>
                            <input type="number" name="daily_rate" id="edit_daily_rate" step="0.01" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date Hired</label>
                            <input type="date" name="date_hired" id="edit_date_hired" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Weekly Schedule</h3>
                    <p class="text-sm text-gray-600 mb-4">Configure working days and hours for each day of the week. Uncheck days that are rest days.</p>
                    
                    <!-- Sunday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="sunday_is_working" id="edit_sunday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Sunday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_sunday-times" style="display: none;">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="sunday_start_time" id="edit_sunday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="sunday_end_time" id="edit_sunday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Monday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="monday_is_working" id="edit_monday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Monday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_monday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="monday_start_time" id="edit_monday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="monday_end_time" id="edit_monday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tuesday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="tuesday_is_working" id="edit_tuesday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Tuesday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_tuesday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="tuesday_start_time" id="edit_tuesday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="tuesday_end_time" id="edit_tuesday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wednesday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="wednesday_is_working" id="edit_wednesday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Wednesday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_wednesday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="wednesday_start_time" id="edit_wednesday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="wednesday_end_time" id="edit_wednesday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thursday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="thursday_is_working" id="edit_thursday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Thursday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_thursday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="thursday_start_time" id="edit_thursday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="thursday_end_time" id="edit_thursday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Friday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="friday_is_working" id="edit_friday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Friday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_friday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="friday_start_time" id="edit_friday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="friday_end_time" id="edit_friday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Saturday -->
                    <div class="border rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="saturday_is_working" id="edit_saturday_is_working" class="mr-2 w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500">
                                <span class="font-medium text-gray-700">Saturday</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3 edit_saturday-times">
                            <div>
                                <label class="block text-xs text-gray-600">Start Time</label>
                                <input type="time" name="saturday_start_time" id="edit_saturday_start_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End Time</label>
                                <input type="time" name="saturday_end_time" id="edit_saturday_end_time" class="mt-1 w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700">Schedule Effective From</label>
                        <input type="date" name="schedule_effective_from" id="edit_schedule_effective_from" value="{{ today }}" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        <p class="text-xs text-gray-500 mt-1">This schedule will be effective from this date onwards</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">New PIN (leave blank to keep current)</label>
                        <input type="password" name="pin" pattern="\d{4}" maxlength="4" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="Enter new 4-digit PIN">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="font-semibold text-teal-700 border-b pb-2">ID Photo & Documents</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID Photo</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div id="editCameraPlaceholder" class="text-center py-8">
                                <img id="editCurrentPhoto" class="hidden w-32 h-32 rounded-full mx-auto mb-4 object-cover border-4 border-teal-200">
                                <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-500">Update ID photo</p>
                                <button type="button" onclick="startCamera('edit')" class="mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                                    Start Camera
                                </button>
                            </div>
                            <video id="editCameraPreview" class="hidden w-full rounded-lg" autoplay playsinline></video>
                            <img id="editCapturedPhoto" class="hidden w-full rounded-lg">
                            <input type="hidden" name="id_photo" id="editIdPhotoData">
                            <div class="mt-4 flex justify-center space-x-2">
                                <button type="button" id="editCaptureBtn" onclick="capturePhoto('edit')" class="hidden px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">
                                    Capture Photo
                                </button>
                                <button type="button" id="editRetakeBtn" onclick="retakePhoto('edit')" class="hidden px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    Retake
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">CV/Resume (PDF)</label>
                        <p id="edit_cv_status" class="text-xs text-gray-500 mb-1"></p>
                        <input type="file" name="cv_file" accept=".pdf" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Government IDs</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">SSS Number</label>
                            <input type="text" name="sss_number" id="edit_sss_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">PhilHealth Number</label>
                            <input type="text" name="philhealth_number" id="edit_philhealth_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Pag-IBIG Number</label>
                            <input type="text" name="pagibig_number" id="edit_pagibig_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">TIN</label>
                            <input type="text" name="tin_number" id="edit_tin_number" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Emergency Contact</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Contact Name</label>
                        <input type="text" name="emergency_contact_name" id="edit_emergency_contact_name" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Contact Phone</label>
                            <input type="tel" name="emergency_contact_phone" id="edit_emergency_contact_phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Relationship</label>
                            <input type="text" name="emergency_contact_relationship" id="edit_emergency_contact_relationship" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-teal-700 border-b pb-2 pt-4">Reference Person</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Reference Name</label>
                        <input type="text" name="reference_name" id="edit_reference_name" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Reference Phone</label>
                            <input type="tel" name="reference_phone" id="edit_reference_phone" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Company/Organization</label>
                            <input type="text" name="reference_company" id="edit_reference_company" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3 border-t pt-4">
                <button type="button" onclick="closeModal('editEmployeeModal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- View Employee Modal -->
<div id="viewEmployeeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto py-4">
    <div class="bg-white rounded-xl p-6 w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-start mb-4">
            <h2 class="text-xl font-bold text-teal-800">Employee Details</h2>
            <button onclick="closeModal('viewEmployeeModal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="viewEmployeeContent"></div>
    </div>
</div>

<!-- Status Change Modal -->
<div id="statusChangeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md">
        <div class="flex justify-between items-start mb-4">
            <h2 class="text-xl font-bold text-coral-300">Change Employee Status</h2>
            <button type="button" onclick="closeModal('statusChangeModal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <p class="text-gray-600 mb-4">Change status for <span id="statusChangeName" class="font-bold"></span></p>
        <form id="statusChangeForm" method="POST">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">New Status *</label>
                    <select name="status" id="statusSelect" required class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-coral-300">
                        <option value="">Select Status</option>
                        <option value="resigned">Resigned</option>
                        <option value="terminated">Terminated</option>
                        <option value="others">Others</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Reason/Description *</label>
                    <textarea name="status_reason" required rows="3" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-coral-300" placeholder="Please provide a detailed reason for this status change (for records/legal purposes)"></textarea>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" onclick="closeModal('statusChangeModal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-coral-300 text-white rounded-lg hover:bg-coral-500">Confirm Change</button>
            </div>
        </form>
    </div>
</div>

{% block scripts %}
<script>
let cameraStreams = {};

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
    stopAllCameras();
}

function stopAllCameras() {
    Object.keys(cameraStreams).forEach(key => {
        if (cameraStreams[key]) {
            cameraStreams[key].getTracks().forEach(track => track.stop());
            cameraStreams[key] = null;
        }
    });
}

async function startCamera(prefix) {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        cameraStreams[prefix] = stream;
        
        const video = document.getElementById(prefix + 'CameraPreview');
        const placeholder = document.getElementById(prefix + 'CameraPlaceholder');
        const capturedImg = document.getElementById(prefix + 'CapturedPhoto');
        const captureBtn = document.getElementById(prefix + 'CaptureBtn');
        const retakeBtn = document.getElementById(prefix + 'RetakeBtn');
        
        if (prefix === 'edit') {
            document.getElementById('editCurrentPhoto').classList.add('hidden');
        }
        
        video.srcObject = stream;
        video.classList.remove('hidden');
        placeholder.classList.add('hidden');
        capturedImg.classList.add('hidden');
        captureBtn.classList.remove('hidden');
        retakeBtn.classList.add('hidden');
    } catch (err) {
        alert('Could not access camera: ' + err.message);
    }
}

function capturePhoto(prefix) {
    const video = document.getElementById(prefix + 'CameraPreview');
    const capturedImg = document.getElementById(prefix + 'CapturedPhoto');
    const captureBtn = document.getElementById(prefix + 'CaptureBtn');
    const retakeBtn = document.getElementById(prefix + 'RetakeBtn');
    const photoData = document.getElementById(prefix + 'IdPhotoData');
    
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    
    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
    capturedImg.src = dataUrl;
    photoData.value = dataUrl;
    console.log("Photo captured, data length:", dataUrl.length);
    
    if (cameraStreams[prefix]) {
        cameraStreams[prefix].getTracks().forEach(track => track.stop());
        cameraStreams[prefix] = null;
    }
    
    video.classList.add('hidden');
    capturedImg.classList.remove('hidden');
    captureBtn.classList.add('hidden');
    retakeBtn.classList.remove('hidden');
}

function retakePhoto(prefix) {
    document.getElementById(prefix + 'IdPhotoData').value = '';
    startCamera(prefix);
}

function viewEmployee(id) {
    fetch('/admin/employees/' + id + '/json')
        .then(response => response.json())
        .then(data => {
            const emp = data.employee;
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="text-center mb-4">
                            ${emp.id_photo ? 
                                `<img src="${emp.id_photo.startsWith('data:') ? emp.id_photo : '/' + emp.id_photo}" class="w-32 h-32 rounded-full mx-auto object-cover border-4 border-teal-200">` :
                                `<div class="w-32 h-32 rounded-full mx-auto bg-gray-300 flex items-center justify-center border-4 border-teal-200"><i class="fas fa-user text-4xl text-gray-500"></i></div>`
                            }
                            <h3 class="text-xl font-bold mt-2">${emp.first_name} ${emp.last_name}</h3>
                            <p class="text-gray-500">${emp.position || 'No Position'}</p>
                            <span class="px-3 py-1 text-sm rounded-full ${emp.status === 'active' ? 'bg-teal-100 text-teal-700' : emp.status === 'terminated' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}">${(emp.status || 'active').charAt(0).toUpperCase() + (emp.status || 'active').slice(1)}</span>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p><strong>Employee ID:</strong> ${emp.employee_id}</p>
                            <p><strong>Branch:</strong> ${emp.branch_name || 'N/A'}</p>
                            <p><strong>Daily Rate:</strong> ₱${parseFloat(emp.daily_rate).toFixed(2)}</p>
                            <p><strong>Schedule:</strong> ${emp.start_time || '08:00'} - ${emp.end_time || '17:00'}</p>
                            <p><strong>Date Hired:</strong> ${emp.date_hired || 'N/A'}</p>
                            <p><strong>Date of Birth:</strong> ${emp.date_of_birth || 'N/A'}</p>
                            <p><strong>Gender:</strong> ${emp.gender ? emp.gender.charAt(0).toUpperCase() + emp.gender.slice(1) : 'N/A'}</p>
                            <p><strong>Civil Status:</strong> ${emp.civil_status ? emp.civil_status.charAt(0).toUpperCase() + emp.civil_status.slice(1) : 'N/A'}</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-teal-700 border-b pb-1">Contact Information</h4>
                            <p class="text-sm mt-2"><strong>Address:</strong> ${emp.address || 'N/A'}</p>
                            <p class="text-sm"><strong>Phone:</strong> ${emp.phone || 'N/A'}</p>
                            <p class="text-sm"><strong>Email:</strong> ${emp.email || 'N/A'}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-teal-700 border-b pb-1">Government IDs</h4>
                            <p class="text-sm mt-2"><strong>SSS:</strong> ${emp.sss_number || 'N/A'}</p>
                            <p class="text-sm"><strong>PhilHealth:</strong> ${emp.philhealth_number || 'N/A'}</p>
                            <p class="text-sm"><strong>Pag-IBIG:</strong> ${emp.pagibig_number || 'N/A'}</p>
                            <p class="text-sm"><strong>TIN:</strong> ${emp.tin_number || 'N/A'}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-teal-700 border-b pb-1">Emergency Contact</h4>
                            <p class="text-sm mt-2"><strong>Name:</strong> ${emp.emergency_contact_name || 'N/A'}</p>
                            <p class="text-sm"><strong>Phone:</strong> ${emp.emergency_contact_phone || 'N/A'}</p>
                            <p class="text-sm"><strong>Relationship:</strong> ${emp.emergency_contact_relationship || 'N/A'}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-teal-700 border-b pb-1">Reference</h4>
                            <p class="text-sm mt-2"><strong>Name:</strong> ${emp.reference_name || 'N/A'}</p>
                            <p class="text-sm"><strong>Phone:</strong> ${emp.reference_phone || 'N/A'}</p>
                            <p class="text-sm"><strong>Company:</strong> ${emp.reference_company || 'N/A'}</p>
                        </div>
                        ${emp.cv_file ? `<div><a href="/${emp.cv_file}" target="_blank" class="inline-flex items-center text-teal-600 hover:text-teal-800"><i class="fas fa-file-pdf mr-2"></i>View CV/Resume</a></div>` : ''}
                        ${emp.status_reason ? `<div class="bg-yellow-50 p-3 rounded-lg"><h4 class="font-semibold text-yellow-800">Status Reason</h4><p class="text-sm text-yellow-700 mt-1">${emp.status_reason}</p><p class="text-xs text-yellow-600 mt-1">Date: ${emp.status_date || 'N/A'}</p></div>` : ''}
                    </div>
                </div>
            `;
            document.getElementById('viewEmployeeContent').innerHTML = html;
            document.getElementById('viewEmployeeModal').classList.remove('hidden');
        });
}

function editEmployee(id) {
    fetch('/admin/employees/' + id + '/json')
        .then(response => response.json())
        .then(data => {
            const emp = data.employee;
            const schedule = data.schedule;
            
            document.getElementById('editEmployeeForm').action = '/admin/employees/' + id + '/edit';
            document.getElementById('edit_employee_id').value = emp.employee_id || '';
            document.getElementById('edit_first_name').value = emp.first_name || '';
            document.getElementById('edit_last_name').value = emp.last_name || '';
            document.getElementById('edit_branch_id').value = emp.branch_id || '';
            document.getElementById('edit_daily_rate').value = emp.daily_rate || '';
            document.getElementById('edit_position').value = emp.position || '';
            document.getElementById('edit_date_of_birth').value = emp.date_of_birth || '';
            document.getElementById('edit_gender').value = emp.gender || '';
            document.getElementById('edit_civil_status').value = emp.civil_status || '';
            document.getElementById('edit_address').value = emp.address || '';
            document.getElementById('edit_phone').value = emp.phone || '';
            document.getElementById('edit_email').value = emp.email || '';
            document.getElementById('edit_date_hired').value = emp.date_hired || '';
            document.getElementById('edit_sss_number').value = emp.sss_number || '';
            document.getElementById('edit_philhealth_number').value = emp.philhealth_number || '';
            document.getElementById('edit_pagibig_number').value = emp.pagibig_number || '';
            document.getElementById('edit_tin_number').value = emp.tin_number || '';
            document.getElementById('edit_emergency_contact_name').value = emp.emergency_contact_name || '';
            document.getElementById('edit_emergency_contact_phone').value = emp.emergency_contact_phone || '';
            document.getElementById('edit_emergency_contact_relationship').value = emp.emergency_contact_relationship || '';
            document.getElementById('edit_reference_name').value = emp.reference_name || '';
            document.getElementById('edit_reference_phone').value = emp.reference_phone || '';
            document.getElementById('edit_reference_company').value = emp.reference_company || '';
            
            // Populate schedule
            if (schedule) {
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                days.forEach(day => {
                    const isWorking = schedule[`${day}_is_working`];
                    const checkbox = document.getElementById(`edit_${day}_is_working`);
                    if (checkbox) {
                        checkbox.checked = isWorking;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                    
                    const startTime = schedule[`${day}_start_time`];
                    const endTime = schedule[`${day}_end_time`];
                    
                    const startInput = document.getElementById(`edit_${day}_start_time`);
                    const endInput = document.getElementById(`edit_${day}_end_time`);
                    
                    let startValue = '08:00';
                    let endValue = '17:00';
                    
                    if (startTime && startTime !== null && startTime !== 'null') {
                        startValue = String(startTime).substring(0, 5);
                    }
                    
                    if (endTime && endTime !== null && endTime !== 'null') {
                        endValue = String(endTime).substring(0, 5);
                    }
                    
                    if (startInput) startInput.value = startValue;
                    if (endInput) endInput.value = endValue;
                });
            }
            
            const currentPhoto = document.getElementById('editCurrentPhoto');
            const placeholder = document.getElementById('editCameraPlaceholder');
            if (emp.id_photo) {
                currentPhoto.src = emp.id_photo.startsWith('data:') ? emp.id_photo : '/' + emp.id_photo;
                currentPhoto.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                currentPhoto.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }
            
            document.getElementById('edit_cv_status').textContent = emp.cv_file ? 'Current file: ' + emp.cv_file.split('/').pop() : 'No CV uploaded';
            
            document.getElementById('editEmployeeModal').classList.remove('hidden');
        });
}

function openStatusChange(id, name) {
    document.getElementById('statusChangeForm').action = '/admin/employees/' + id + '/status';
    document.getElementById('statusChangeName').textContent = name;
    document.getElementById('statusSelect').value = '';
    document.getElementById('statusChangeModal').classList.remove('hidden');
}

// Toggle schedule time inputs based on checkbox state
function setupScheduleToggles(prefix = '') {
    const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
    const selectorPrefix = prefix ? `edit_` : '';
    const classPrefix = prefix ? `edit_` : '';
    
    days.forEach(day => {
        const checkbox = document.getElementById(`${selectorPrefix}${day}_is_working`) || document.querySelector(`input[name="${day}_is_working"]`);
        if (checkbox) {
            checkbox.addEventListener('change', function() {
                const timesDiv = document.querySelector(`.${classPrefix}${day}-times`);
                if (timesDiv) {
                    timesDiv.style.display = this.checked ? 'grid' : 'none';
                }
            });
            // Trigger initial state
            checkbox.dispatchEvent(new Event('change'));
        }
    });
}

// Initialize schedule toggles when page loads
document.addEventListener('DOMContentLoaded', function() {
    setupScheduleToggles(); // For Add form
    setupScheduleToggles('edit'); // For Edit form
});
</script>
{% endblock %}
{% endblock %}
